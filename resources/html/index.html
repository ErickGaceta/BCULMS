<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/bootstrap.css" />
    <link rel="stylesheet" href="../css/bootstrap-grid.css" />
    <link rel="stylesheet" href="../css/bootstrap-icons.css" />
  </head>
  <body>
    <div id="loader" role="status" aria-live="polite">
      <div class="loader-box">
        <div class="loader-book" aria-hidden="true">
          <div class="book">
            <div class="book-left"></div>
            <div class="book-right"></div>
            <div class="book-page"></div>
          </div>
        </div>
        <p id="loader-text">Loading assets...</p>
      </div>
    </div>
    <!-- SIDEBAR -->
    <aside class="sidebar" role="navigation" aria-label="Main navigation">
      <nav class="nav flex-column">
        <a href="./index.html" class="d-flex justify-content-center mb-5" aria-label="BCULMS Home">
          <img src="../icons/appIcon.png" alt="BCULMS Logo" width="100" height="100">
        </a>
        <a class="nav-link mb-3 active" href="./index.html" aria-current="page" aria-label="Dashboard">
          <p></p>
          <span class="icon" aria-hidden="true">
            <i class="bi bi-grid-1x2"></i>
          </span>
          <span class="description">Dashboard</span>
        </a>

        <a
          class="nav-link mb-3"
          data-bs-toggle="collapse"
          data-bs-target="#submenuBookshelf"
          role="button"
          aria-expanded="false"
          aria-controls="submenuBookshelf"
          aria-label="Bookshelf menu"
        >
        <p></p>
          <span class="icon" aria-hidden="true">
            <i class="bi bi-book"></i>
          </span>
          <span class="description">
            Bookshelf <i class="bi bi-caret-down" aria-hidden="true"></i>
          </span>
        </a>
        <div class="sub-menu collapse mb-1" id="submenuBookshelf">
          <a href="./bookshelf-books.html" class="nav-link mb-2" aria-label="Books management">
            <p></p>
            <span class="icon" aria-hidden="true">
              <i class="bi bi-book-fill"></i>
            </span>
            <span class="description">Books</span>
          </a>
          <a href="./bookshelf-copies.html" class="nav-link mb-2" aria-label="Book copies management">
            <p></p>
            <span class="icon" aria-hidden="true">
              <i class="bi bi-book-half"></i>
            </span>
            <span class="description">Copies</span>
          </a>
        </div>

        <!-- Transactions -->
        <a
          class="nav-link mb-3"
          data-bs-toggle="collapse"
          data-bs-target="#submenuTransactions"
          role="button"
          aria-expanded="false"
          aria-controls="submenuTransactions"
        >
          <p></p>
          <span class="icon">
            <i class="bi bi-person-lines-fill"></i>
          </span>
          <span class="description">
            Transactions <i class="bi bi-caret-down"></i>
          </span>
        </a>
        <div class="sub-menu collapse mb-1" id="submenuTransactions">
          <a href="./transactions_borrow.html" class="nav-link mb-2">
            <p></p>
            <span class="icon">
              <i class="bi bi-calendar-range-fill"></i>
            </span>
            <span class="description">Borrows</span>
          </a>
          <a href="./transaction_library.html" class="nav-link mb-2">
            <p></p>
            <span class="icon">
              <i class="bi bi-database-fill-gear"></i>
            </span>
            <span class="description">Library</span>
          </a>
        </div>

        <a class="nav-link mb-3" href="./students.html">
          <p></p>
          <span class="icon">
            <i class="bi bi-person-badge"></i>
          </span>
          <span class="description">Student Page</span>
        </a>

        <!-- Archives -->
        <a
          class="nav-link mb-3"
          data-bs-toggle="collapse"
          data-bs-target="#submenuArchives"
          role="button"
          aria-expanded="false"
          aria-controls="submenuArchives"
        >
          <p></p>
          <span class="icon">
            <i class="bi bi-archive"></i>
          </span>
          <span class="description">
            Archives <i class="bi bi-caret-down"></i>
          </span>
        </a>
        <div class="sub-menu collapse mb-1" id="submenuArchives">
          <a href="./archived-books.html" class="nav-link mb-2">
            <p></p>
            <span class="icon">
              <i class="bi bi-archive-fill"></i>
            </span>
            <span class="description">Archived Books</span>
          </a>
          <a href="./archived-students.html" class="nav-link mb-2">
            <p></p>
            <span class="icon">
              <i class="bi bi-person-x-fill"></i>
            </span>
            <span class="description">Archived Students</span>
          </a>
        </div>
      </nav>
    </div>

    <!-- MAIN -->
    <main class="main-content" role="main">
      <div id="image-container" aria-hidden="true">
        <img src="../images/bcu_building2.jpg" alt="Bicol University Campus Building" id="background" />
      </div>
      <h1 class="display-6 mb-4">Dashboard</h1>
      <div class="container-fluid">
        <!-- STATISTICS -->
        <section class="row mb-5" aria-labelledby="statistics-heading">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h2 id="statistics-heading" class="h4 mb-0">Library Statistics</h2>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-12 col-md-6 col-lg-3">
                    <div class="card stats-card text-center">
                      <div class="card-body">
                        <h3 class="h6 text-uppercase fw-bold mb-2">Total Books</h3>
                        <p class="display-4 mb-0" id="totalBooks" aria-live="polite">0</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-md-6 col-lg-3">
                    <div class="card stats-card text-center">
                      <div class="card-body">
                        <h3 class="h6 text-uppercase fw-bold mb-2">Borrowed Books</h3>
                        <p class="display-4 mb-0" id="borrowedBooks" aria-live="polite">0</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-md-6 col-lg-3">
                    <div class="card stats-card text-center">
                      <div class="card-body">
                        <h3 class="h6 text-uppercase fw-bold mb-2">Overdue Books</h3>
                        <p class="display-4 mb-0" id="overdueBooks" aria-live="polite">0</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-md-6 col-lg-3">
                    <div class="card stats-card text-center">
                      <div class="card-body">
                        <h3 class="h6 text-uppercase fw-bold mb-2">Active Students</h3>
                        <p class="display-4 mb-0" id="activeStudents" aria-live="polite">0</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- NOTIFICATIONS AND ACTIVITIES -->
        <section class="row mb-5" aria-labelledby="notifications-heading">
          <div class="col-12 col-lg-6">
            <div class="card">
              <div class="card-header">
                <h2 id="notifications-heading" class="h4 mb-0">
                  <i class="bi bi-bell-fill me-2" aria-hidden="true"></i>
                  Notifications
                </h2>
              </div>
              <div class="card-body">
                <div class="alert alert-info" role="status">
                  <i class="bi bi-info-circle-fill me-2" aria-hidden="true"></i>
                  <span id="notification-content">Loading notifications...</span>
                </div>
              </div>
            </div>
          </div>
          <!-- RECENT ACTIVITIES -->
          <div class="col-12 col-lg-6">
            <div class="card">
              <div class="card-header">
                <h2 id="activities-heading" class="h4 mb-0">
                  <i class="bi bi-clock-history me-2" aria-hidden="true"></i>
                  Recent Activity
                </h2>
              </div>
              <div class="card-body">
                <div class="activity-list" id="recent-activities" aria-live="polite">
                  <p class="text-muted">Loading recent activities...</p>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- QUICK ACTIONS -->
        <section class="row justify-content-end" aria-labelledby="actions-heading">
          <div class="col-12 col-md-8 col-lg-6">
            <div class="card">
              <div class="card-header">
                <h2 id="actions-heading" class="h4 mb-0">
                  <i class="bi bi-lightning-fill me-2" aria-hidden="true"></i>
                  Quick Actions
                </h2>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-12 col-sm-6">
                    <a href="bookshelf-books.html?modal=addBookContent" 
                       class="btn btn-primary w-100" 
                       role="button"
                       aria-label="Add new books to the library">
                      <i class="bi bi-plus-circle me-2" aria-hidden="true"></i>
                      Add Books
                    </a>
                  </div>
                  <div class="col-12 col-sm-6">
                    <button type="button" 
                            class="btn btn-outline-primary w-100" 
                            id="archiveBookBtn"
                            aria-label="Archive books from the library">
                      <i class="bi bi-archive me-2" aria-hidden="true"></i>
                      Archive Books
                    </button>
                  </div>
                  <div class="col-12 col-sm-6">
                    <a href="students.html?modal=addStudentContent" 
                       class="btn btn-info w-100" 
                       role="button"
                       aria-label="Add new student record">
                      <i class="bi bi-person-plus me-2" aria-hidden="true"></i>
                      Add Student Record
                    </a>
                  </div>
                  <div class="col-12 col-sm-6">
                    <a href="transaction_library.html" 
                       class="btn btn-outline-secondary w-100" 
                       role="button"
                       aria-label="View library transactions">
                      <i class="bi bi-list-ul me-2" aria-hidden="true"></i>
                      View Transactions
                    </a>
                  </div>
                  <div class="col-12 col-sm-6">
                    <button type="button"
                            class="btn btn-outline-dark w-100"
                            id="openDbFolderBtn"
                            aria-label="Open database folder">
                      <i class="bi bi-folder2-open me-2" aria-hidden="true"></i>
                      Open Database Folder
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script src="../js/bootstrap.bundle.js"></script>
    <script src="../js/neutralino.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/sql-wasm.js"></script>
    <script src="../js/database-connection.js"></script>
    <script src="../js/database-operations.js"></script>
    <script src="../js/create-table.js"></script>
    <script src="../js/seed-tables.js"></script>
    <script src="../js/frontend-operations.js"></script>
    <script src="../js/library-operations.js"></script>
    <script src="../js/getFromDB.js"></script>
    <script src="../js/insertIntoDB.js"></script>
    <script src="../js/dashboard.js"></script>
    <script src="../js/popup.js"></script>
    <script src="../js/app.js"></script>
    <script>
      (function() {
        async function runLoader() {
          var loader = document.getElementById('loader');
          var loaderText = document.getElementById('loader-text');
          if (!loader) return;
          var minDisplayMs = 3000;
          var start = performance.now();
          var setText = function(t){ if (loaderText) loaderText.textContent = t; };

          function preloadImage(src) {
            return new Promise(function(resolve){
              var img = new Image();
              img.onload = function(){ resolve(true); };
              img.onerror = function(){ resolve(false); };
              img.src = src;
            });
          }

          try {
            setText('Loading assets...');
            var assetsPromise = preloadImage('../images/bcu_building2.jpg');

            setText('Initializing database...');
            await new Promise(function(r){ setTimeout(r, 1000); });
            var dbInitPromise = (async function(){
              try {
                if (typeof initPath === 'function') await initPath();
                if (typeof initDB === 'function') await initDB();
                if (typeof waitForDBReady === 'function') await waitForDBReady(8000);
              } catch (e) {
                console.error('DB init error:', e);
              }
            })();

            await Promise.all([assetsPromise, dbInitPromise]);
            setText('Finalizing setup...');
          } catch (err) {
            console.error('Loader error:', err);
            setText('Starting application...');
          } finally {
            var elapsed = performance.now() - start;
            var waitMore = Math.max(0, minDisplayMs - elapsed);
            setTimeout(function(){
              loader.style.display = 'none';
              loader.setAttribute('aria-hidden', 'true');
            }, waitMore);
          }
        }
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', runLoader);
        } else {
          runLoader();
        }
      })();
    </script>
  </body>
</html>
